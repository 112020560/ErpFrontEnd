<div class="animated fadeIn">
    <div class="row">
        <div class="col">
            <div class="card">
                <div class="card-header">
                    <i class="icon-plus"></i>
                    <strong>Nueva Factura</strong>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col">
                            <mat-form-field>
                                <mat-select placeholder="Tipo de Venta:" [(ngModel)]="tipoVentaSelected" required
                                    style="width: 100;" name="servicesbatch" id="servicesbatch"
                                    (selectionChange)="ngChangeSaleType($event.value)">
                                    <mat-option *ngFor="let item of tipoVentaList" value="{{item.pkTipoDocumento}}">
                                        {{item.descripcion}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>

                        <div class="col">
                            <mat-form-field>
                                <mat-select placeholder="Bodega Origen:" [(ngModel)]="bodegaSelected" required
                                    style="width: 100;" name="servicesbatch" id="servicesbatch"
                                    (selectionChange)="ngChangeBodega($event.value)">
                                    <mat-option *ngFor="let item of bodegaList" value="{{item.pkBodega}}">
                                        {{item.descripcion}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>

                        <div class="col">
                            <mat-form-field>
                                <input matInput [matDatepicker]="pickerI" [formControl]="dateI" tabindex="3" id="fechaI"
                                    readonly placeholder="Fecha Venta">
                                <mat-datepicker-toggle matSuffix [for]="pickerI"></mat-datepicker-toggle>
                                <mat-datepicker #pickerI></mat-datepicker>
                            </mat-form-field>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <mat-form-field>
                                <mat-select placeholder="Cliente:" [(ngModel)]="clienteSelected" required
                                    style="width: 100;" name="servicesbatch" id="servicesbatch"
                                    (selectionChange)="ngChangeClients($event.value)">
                                    <mat-option *ngFor="let item of clienteList" value="{{item.pkPersona}}">
                                        {{item.nombreCompleto}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>

                        <div class="col">
                            <mat-form-field class="example-full-width">
                                <input matInput placeholder="Telefono :" required name="prioridad" readonly
                                    [(ngModel)]="telefonoSelected">
                            </mat-form-field>
                        </div>

                        <div class="col">
                            <mat-form-field class="example-full-width">
                                <input matInput placeholder="Correo :" required name="prioridad" readonly
                                    [(ngModel)]="correoSelected">
                            </mat-form-field>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <div style="text-align:left">
                                <button type="button" pButton icon="fa fa-plus" [disabled]="bodegaSelected === '0'"
                                    id="btnadditem" (click)="showDialogToAdd()" label="Nuevo"></button>
                            </div>
                        </div>
                        <div class="col">

                        </div>
                        <div class="col">

                        </div>
                        <div class="col">

                        </div>
                        <div class="col">
                            <div style="text-align:right">
                                <button type="button" pButton icon="fa fa-save" class="ui-button-success"
                                    [disabled]="items.length === 0" (click)="showDialogToAdd()"
                                    label="Guardar"></button>
                            </div>
                        </div>
                        <div class="col">
                            <div style="text-align:left">
                                <button type="button" pButton icon="fa fa-eraser" class="ui-button-warning"
                                    [disabled]="items.length === 0" (click)="showDialogToAdd()"
                                    label="Limpiar"></button>
                            </div>
                        </div>
                    </div>
                    <hr />
                    <div class="row  mt-2">
                        <div class="col">
                            <div class="table-responsive">
                                <p-table [columns]="cols" [value]="items" selectionMode="single"
                                    [(selection)]="selectedCar" (onRowSelect)="onRowSelect($event)" [paginator]="true"
                                    [rows]="10" [responsive]="true">
                                    <ng-template pTemplate="caption">
                                        Articulos de la ventas
                                    </ng-template>
                                    <ng-template pTemplate="header" let-columns>
                                        <tr>
                                            <th *ngFor="let col of columns" [pSortableColumn]="col.field">
                                                {{col.header}}
                                                <p-sortIcon [field]="col.field"></p-sortIcon>
                                            </th>
                                        </tr>
                                    </ng-template>
                                    <ng-template pTemplate="body" let-rowData let-columns="columns">
                                        <!-- <tr [pSelectableRow]="rowData">
                                            <td *ngFor="let col of columns">
                                                {{rowData[col.field]}}
                                            </td>
                                        </tr> -->
                                        <tr [pSelectableRow]="rowData">
                                            <td>
                                                {{rowData['codigo']}}
                                            </td>
                                            <td>
                                                {{rowData['descripcion']}}
                                            </td>
                                            <td>
                                                {{rowData['cantidad']}}
                                            </td>
                                            <td>
                                                {{rowData['precio']  | number}}
                                            </td>
                                            <td>
                                                {{rowData['descuento']  | number}}
                                            </td>
                                            <td>
                                                {{rowData['sumas']  | number}}
                                            </td>
                                            <td>
                                                {{rowData['iva'] | number}}
                                            </td>
                                            <td>
                                                {{rowData['total'] | number}}
                                            </td>
                                        </tr>
                                    </ng-template>
                                    <ng-template pTemplate="footer">
                                        <tr>
                                            <td colspan="4">Totales</td>
                                            <!-- <td>{{simbolo}}{{precios | number}}</td> -->
                                            <td>{{simbolo}}{{descuentos | number}}</td>
                                            <td>{{simbolo}}{{sumas | number}}</td>
                                            <td>{{simbolo}}{{iva | number}}</td>
                                            <td>{{simbolo}}{{total | number}}</td>
                                        </tr>
                                    </ng-template>
                                    <!-- <ng-template pTemplate="summary" let-rowData>
                                        <div class="col">
                                            <div style="text-align:left">
                                                <button type="button" pButton icon="fa fa-plus"
                                                    (click)="showDialogToAdd()" label="Nuevo"></button>
                                            </div>
                                        </div>
                                    </ng-template> -->
                                </p-table>
                            </div>


                            <p-dialog header="Detalle del articulo" [(visible)]="displayDialog" [focusOnShow]="false"
                                [responsive]="true" showEffect="fade" [modal]="true" [style]="{width: '500px'}">
                                <div class="ui-g ui-fluid" *ngIf="car">
                                    <div class="ui-g-12">
                                        <div class="ui-g-4">
                                            <label for="codigo">Codigo</label>
                                        </div>
                                        <div class="ui-g-8">
                                            <!-- <input pInputText id="codigo" [(ngModel)]="car.codigo" autofocus /> -->
                                            <p-dropdown [options]="articulosList" [(ngModel)]="car.id" filter="true"
                                                (onChange)="ngArticulosChange($event.value)">
                                                <ng-template let-car pTemplate="item">
                                                    <div class="ui-helper-clearfix"
                                                        style="position: relative;height: 25px;">
                                                        <div>{{car.label}}</div>
                                                    </div>
                                                </ng-template>
                                            </p-dropdown>
                                        </div>
                                    </div>
                                    <div class="ui-g-12">
                                        <div class="ui-g-4">
                                            <label for="desc">Descripcion</label>
                                        </div>
                                        <div class="ui-g-8">
                                            <input pInputText id="desc" [(ngModel)]="car.descripcion" />
                                        </div>
                                    </div>
                                    <div class="ui-g-12">
                                        <div class="ui-g-4">
                                            <label for="cantidad">Cantidad</label>
                                        </div>
                                        <div class="ui-g-8">
                                            <input pInputText type="number" id="cantidad" [(ngModel)]="car.cantidad"
                                                id="cantidad" (keypress)="onKeyPress($event)" />
                                        </div>
                                    </div>
                                    <div class="ui-g-12">
                                        <div class="ui-g-4">
                                            <label for="precio">Precio</label>
                                        </div>
                                        <div class="ui-g-8">
                                            <input pInputText id="precio" [(ngModel)]="car.precio" readonly />
                                        </div>
                                    </div>
                                    <div class="ui-g-12">
                                        <div class="ui-g-4">
                                            <a href="javascript:void(0)" (click)="openDiscountDialog()">
                                                <label for="descuento">Descuento</label>
                                            </a>
                                        </div>
                                        <div class="ui-g-8">
                                            <input pInputText id="descuento" [(ngModel)]="car.descuento" />
                                        </div>
                                    </div>
                                    <div class="ui-g-12">
                                        <div class="ui-g-4">
                                            <label for="iva">IVA</label>
                                        </div>
                                        <div class="ui-g-8">
                                            <input pInputText id="iva" [(ngModel)]="car.iva" readonly />
                                        </div>
                                    </div>
                                </div>
                                <p-footer>
                                    <div class="ui-dialog-buttonpane ui-helper-clearfix">
                                        <button type="button" pButton icon="fa fa-close" (click)="delete()" class="ui-button-danger"
                                            label="Borrar"></button>
                                        <button type="button" pButton icon="fa fa-check" (click)="save()"
                                            label="Guardar"></button>
                                    </div>
                                </p-footer>
                            </p-dialog>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <p-dialog header="Detalle del articulo" [(visible)]="displayDiscount" [focusOnShow]="false" [responsive]="true"
        showEffect="fade" [modal]="true" [style]="{width: '500px'}">
        <div class="ui-g ui-fluid">
            <div class="ui-g-12">
                <div class="ui-g-4">
                    <label for="codigo">Codigo</label>
                </div>
                <div class="ui-g-8">
                    <!-- <input pInputText id="codigo" [(ngModel)]="car.codigo" autofocus /> -->
                    <p-dropdown [options]="tipoDescuento" [(ngModel)]="tipoDescuentoSelected"
                        (onChange)="ngArticulosChange($event.value)">
                        <ng-template let-car pTemplate="item">
                            <div class="ui-helper-clearfix" style="position: relative;height: 25px;">
                                <div>{{car.label}}</div>
                            </div>
                        </ng-template>
                    </p-dropdown>
                </div>
            </div>
            <div class="ui-g-12">
                <div class="ui-g-4">
                    <label for="valor">Valor</label>
                </div>
                <div class="ui-g-8">
                    <input pInputText id="valor" [(ngModel)]="montoDescuento" />
                </div>
            </div>
        </div>
        <p-footer>
                <div class="ui-dialog-buttonpane ui-helper-clearfix">
                    <button type="button" pButton icon="fa fa-check" (click)="aplicarDescuento()"
                        label="Aplicar"></button>
                </div>
            </p-footer>
    </p-dialog>
</div>
